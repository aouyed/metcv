import xarray as xr
from metpy.interpolate import interpolate_1d
import numpy as np
import glob
from pathlib import Path
from natsort import natsorted


varnames = ['u', 'v', 'qv']

for varname in varnames:

    files = natsorted(
        glob.glob('../../data/raw/experiments/07_01_2006/' + varname+'/netcdf/*.nc4'))
    files_pl = natsorted(
        glob.glob('../../data/raw/experiments/07_01_2006/pl/*.nc4*'))

    path = '../../data/raw/experiments/07_01_2006/'+varname+'/850/'
    for i, file in enumerate(files):
        if i > 4:
            break
        print('var file:')
        print(file)
        print('pl file')
        print(files_pl[i])
        ds = xr.open_dataset(file)
        var = ds[varname.upper()]
        var = var.values
        ds = xr.open_dataset(files_pl[i])

        pl = ds['PL']
        pl = pl.values/100

        print('interpolating')

        var_interp = interpolate_1d(850, pl, var, axis=1)

        filename = Path(file).stem
        import pdb
        pdb.set_trace()

        #times = pd.date_range('2000-01-01', periods=4)
        #foo = xr.DataArray(var_interpolate, coords=[times, locs], dims=['time', 'space'])
        # ds = xr.Dataset({varname: (['x', 'y', 'time','height'], var interpolate),
        #                'precipitation': (['x', 'y', 'time'], precip)},
        #              coords={'lon': (['x', 'y'], lon),
        #                     'lat': (['x', 'y'], lat),
        #                    'time': pd.date_range('2014-09-06', periods=3),
        #                   'reference_time': pd.Timestamp('2014-09-05')})

        np.save(path+filename, var_interp)
        print('done interpolation')
