import sqlite3
import os
import pandas as pd


def create_connection():
    """ create a connection to a SQLite database"""
    directory = '../data/interim/sqlite'
    if not os.path.exists(directory):
        os.makedirs(directory)
    db_file = directory + '/geos5'
    conn = None
    try:
        conn = sqlite3.connect(db_file)
    except Error as e:
        print(e)
    finally:
        if conn:
            conn.close()


def add_table(frame, var, date, conn):
    df = pd.DataFrame(frame).stack().rename_axis(
        ['y', 'x']).reset_index(name=var.lower())
    df['datetime'] = date
    df.to_sql(var, conn, if_exists="replace")
